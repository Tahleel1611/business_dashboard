{% extends 'base.html' %}

{% block title %}Sales Graph{% endblock %}

{% block content %}
<h2>ðŸ“Š Sales Analytics Overview</h2>

<!-- Sales Over Time Graph -->
<div class="chart-container">
    <h3>ðŸ“ˆ Sales Over Time</h3>
    <canvas id="salesChart" width="400" height="150"></canvas>
</div>

<!-- Monthly Sales and Purchases Graphs -->
<div class="chart-row">
    <div class="chart-container">
        <h3>ðŸ’° Total Monthly Sales</h3>
        <canvas id="monthlySalesChart" width="200" height="200"></canvas>
    </div>
    
    <div class="chart-container">
        <h3>ðŸ›’ Total Monthly Purchases</h3>
        <canvas id="monthlyPurchasesChart" width="200" height="200"></canvas>
    </div>
</div>

{% endblock %}

{% block scripts %}
{% load static %}
<script src="{% static 'js/simple-charts.js' %}"></script>
<script>
    // Sales Over Time Graph
    var salesDates = JSON.parse('{{ dates|escapejs }}');
    var salesQuantities = JSON.parse('{{ quantities|escapejs }}');

    new SimpleChart('salesChart', {
        type: 'line',
        data: {
            labels: salesDates,
            datasets: [{
                label: 'Sales Quantity',
                data: salesQuantities,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                fill: true,
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: 'Date' } },
                y: { title: { display: true, text: 'Quantity Sold' }, beginAtZero: true }
            }
        }
    });

    // Monthly Sales Graph
    var salesMonths = JSON.parse('{{ sales_months|escapejs }}');
    var salesTotals = JSON.parse('{{ sales_totals|escapejs }}');

    new SimpleChart('monthlySalesChart', {
        type: 'bar',
        data: {
            labels: salesMonths,
            datasets: [{
                label: 'Total Sales (â‚¹)',
                data: salesTotals,
                backgroundColor: 'rgba(39, 174, 96, 0.7)',
                borderColor: '#27ae60',
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    // Monthly Purchases Graph
    var purchaseMonths = JSON.parse('{{ purchase_months|escapejs }}');
    var purchaseTotals = JSON.parse('{{ purchase_totals|escapejs }}');

    new SimpleChart('monthlyPurchasesChart', {
        type: 'bar',
        data: {
            labels: purchaseMonths,
            datasets: [{
                label: 'Total Purchases (â‚¹)',
                data: purchaseTotals,
                backgroundColor: 'rgba(231, 76, 60, 0.7)',
                borderColor: '#e74c3c',
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}
